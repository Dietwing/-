@startuml
title C4 Level 3 — Components: Domain Core (персонажи/бой/события)

left to right direction
skinparam shadowing false
skinparam defaultTextAlignment center
skinparam dpi 150
skinparam RoundCorner 12
skinparam ArrowColor #4A4A4A
skinparam ArrowThickness 1.2

!define BLUE #0B4A7F
!define BLUE_DARK #083B66
!define BLUE_MID #0E5F9E
!define GRAY #6B6B6B

skinparam rectangle {
  BorderColor #2B2B2B
  FontColor white
  BackgroundColor BLUE
}

skinparam rectangle<<boundary>> {
  BackgroundColor transparent
  BorderColor GRAY
  BorderStyle dashed
  FontColor #2B2B2B
  FontSize 13
  Padding 12
}

skinparam rectangle<<comp>> {
  BackgroundColor BLUE
  BorderColor BLUE
  FontSize 12
  Padding 12
}

skinparam rectangle<<core>> {
  BackgroundColor BLUE_MID
  BorderColor BLUE_MID
  FontSize 12
  Padding 12
}

' Контейнер Domain Core — раскрываем компонентами
rectangle "<b>Domain Core</b>\n[container]" <<boundary>> as DC {

  rectangle "<b>Character Model</b>\nсущности: Character/NPC\nStats/Modifiers" <<core>> as CHAR

  rectangle "<b>Combat Model</b>\nсущности боя:\nEncounter, TurnOrder,\nState" <<core>> as COMBAT

  rectangle "<b>Rules Engine</b>\nправила действий:\nпроверки, эффекты,\nограничения" <<core>> as RULEENG

  rectangle "<b>Dice Facade</b>\nединая точка\nдоступа к броскам" <<comp>> as DICEF

  rectangle "<b>Interaction Calculator</b>\nрасчёты взаимодействий:\nурон, эффекты,\nмодификаторы" <<comp>> as CALC

  rectangle "<b>Domain Events</b>\nмодель событий:\nActionPerformed,\nDamageApplied,\nRoundEnded" <<comp>> as EVENTS

  rectangle "<b>Validation</b>\nпроверка корректности:\nзначения, ограничения,\nцелостность" <<comp>> as VALID
}

' Внешняя зависимость с прошлого уровня (Dice/RNG container)
rectangle "Dice / RNG\n[container]\n(из Level 2)" as RNG

' Связи внутри Domain Core
CHAR --> VALID : проверка данных
COMBAT --> RULEENG : применение правил
RULEENG --> CALC : расчёт результатов
CALC --> CHAR : меняет характеристики\n(HP, эффекты)
COMBAT --> EVENTS : публикует события боя
RULEENG --> EVENTS : события действий/эффектов
RULEENG --> DICEF : запрос броска
DICEF --> RNG : вызывает RNG

@enduml
